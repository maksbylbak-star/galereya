<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ì–∞–ª–µ—Ä–µ—è –ê–ª—å–±–æ–º—ñ–≤ üíó</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíñ</text></svg>">
<style>
@import url('https://fonts.googleapis.com/css2?family=Great+Vibes&family=Open+Sans:wght@300;400&display=swap');
body { margin:0; font-family:'Open Sans', sans-serif; background:radial-gradient(circle at 30% 30%, #330d1a, #4d0f2f, #220912); }

/* --- –ó–∞–≥–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ --- */
.container { max-width:900px; margin:auto; padding:25px; color:#ffd1e6; }
.title { font-family:'Great Vibes',cursive; font-size:3rem; text-align:center; color:#ff99cc; text-shadow:0 0 12px rgba(255,150,200,0.5); margin:25px 0; }

/* --- –ë–ª–æ–∫ –∞–ª—å–±–æ–º—ñ–≤ --- */
#albums-view { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:25px; margin-top:20px; }
.album-card { background:rgba(255,255,255,0.05); border-radius:20px; padding:15px; box-shadow:0 0 12px rgba(255,120,180,0.3); transition:0.3s; cursor:pointer; text-align:center; }
.album-card:hover { transform:scale(1.05); box-shadow:0 0 20px rgba(255,160,210,0.6); }
.album-cover { width:100%; height:180px; border-radius:15px; object-fit:cover; background:#000; }
.album-name { margin-top:10px; font-size:1.2rem; color:#ffb4d4; }
.album-count { font-size:0.9rem; color:#ffbed9; margin-top:6px; }

#add-album-btn { margin:20px auto; display:block; padding:10px 22px; background:rgba(255,153,204,0.3); color:#ffbbe2; border:2px solid #ff99cc; border-radius:20px; cursor:pointer; font-size:1.1rem; }
#add-album-btn:hover { background:rgba(255,153,204,0.5); }

/* --- –§–æ—Ç–æ –≤ –∞–ª—å–±–æ–º—ñ --- */
#photos-view { display:none; }
.back-btn { margin-top:20px; cursor:pointer; font-size:1.1rem; color:#ff99cc; text-decoration:underline; }
.album-title { font-family:'Great Vibes', cursive; font-size:2.5rem; text-align:center; margin:20px 0; color:#ff99cc; }
.photo-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:20px; }
.photo-card { position:relative; background:rgba(255,255,255,0.05); padding:10px; border-radius:15px; box-shadow:0 0 10px rgba(255,100,150,0.3); }
.photo-card img { width:100%; height:240px; object-fit:cover; border-radius:12px; cursor:pointer; }
.delete-btn { position:absolute; top:10px; right:10px; width:35px; height:35px; border-radius:50%; background:rgba(255,0,70,0.9); border:none; color:white; font-size:18px; cursor:pointer; display:flex; justify-content:center; align-items:center; }

#add-photo-btn { margin:15px auto; display:block; padding:10px 22px; background:rgba(255,153,204,0.3); color:#ffd1dc; border:2px solid #ff99cc; border-radius:20px; cursor:pointer; font-size:1.1rem; }
#add-photo-btn:hover { background:rgba(255,153,204,0.5); }

.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index:999; }
.modal-box { background:#2b0a1a; padding:25px; border-radius:15px; width:90%; max-width:380px; text-align:center; box-shadow:0 0 15px rgba(255,120,180,0.6); }
.modal-box input { width:90%; padding:10px; border-radius:12px; border:none; margin:10px 0; }
.modal-box button { padding:8px 20px; border-radius:12px; border:none; cursor:pointer; margin:6px; }
.save-btn { background:#ff99cc; color:white; }
.cancel-btn { background:#ff6fa3; color:white; }

/* –ú–æ–¥–∞–ª—å–Ω–µ —Ñ–æ—Ç–æ */
#image-modal img { max-width:80%; max-height:80%; border-radius:20px; box-shadow:0 0 20px rgba(255,120,180,0.8); }
.close-img { position:absolute; top:20px; right:30px; font-size:2.5rem; color:white; cursor:pointer; }

/* –ù–æ—Ç–∏—Ñ—ñ–∫–µ–π—à–Ω –ø—Ä–æ—Å—Ç–∏–π */
.toast { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.6); color:white; padding:8px 14px; border-radius:12px; display:none; }
</style>
</head>
<body>
<div class="container">
  <div id="albums-section">
    <h1 class="title">–ù–∞—à—ñ –∞–ª—å–±–æ–º–∏ üíó</h1>
    <button id="add-album-btn">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–ª—å–±–æ–º</button>
    <div id="albums-view"></div>
  </div>

  <div id="photos-section" style="display:none;">
    <div class="back-btn" id="back-to-albums">‚¨Ö –ù–∞–∑–∞–¥ –¥–æ –∞–ª—å–±–æ–º—ñ–≤</div>
    <h2 class="album-title" id="current-album-name"></h2>
    <button id="add-photo-btn">‚ûï –î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ</button>
    <div class="photo-grid" id="photos-view"></div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–ª—å–±–æ–º—É -->
<div class="modal" id="add-album-modal">
  <div class="modal-box">
    <h2 style="color:#ff99cc;font-family:'Great Vibes',cursive;">–ù–æ–≤–∏–π –∞–ª—å–±–æ–º üìÅ</h2>
    <input id="album-name" type="text" placeholder="–ù–∞–∑–≤–∞ –∞–ª—å–±–æ–º—É" />
    <input id="album-cover" type="file" accept="image/*" />
    <button class="save-btn" id="save-album">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
    <button class="cancel-btn" onclick="closeAlbumModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–æ—Ç–æ -->
<div class="modal" id="add-photo-modal">
  <div class="modal-box">
    <h2 style="color:#ff99cc;font-family:'Great Vibes',cursive;">–ù–æ–≤–µ —Ñ–æ—Ç–æ üíñ</h2>
    <input id="photo-file" type="file" accept="image/*" />
    <input id="photo-desc" type="text" placeholder="–û–ø–∏—Å" />
    <button class="save-btn" id="save-photo">–î–æ–¥–∞—Ç–∏</button>
    <button class="cancel-btn" onclick="closePhotoModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —Ñ–æ—Ç–æ -->
<div class="modal" id="image-modal">
  <span class="close-img" onclick="closeImageModal()">&times;</span>
  <img id="modal-img" />
</div>

<div class="toast" id="toast"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyAj1aM_i39eq42FdFUw9-QZeq0gJhQwb-E",
  authDomain:"galereya-ani.firebaseapp.com",
  projectId:"galereya-ani",
  storageBucket:"galereya-ani.appspot.com",
  messagingSenderId:"564788961310",
  appId:"1:564788961310:web:64512d257bca9aaa18ce0f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentAlbum = null;

const placeholderCover = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='%23220a12'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='48' fill='%23ff99cc'>–ê–ª—å–±–æ–º</text></svg>";

/* --- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–ª—å–±–æ–º—ñ–≤ --- */
function loadAlbums() {
  const view = document.getElementById('albums-view');
  view.innerHTML = "";
  db.collection('albums').orderBy('createdAt').onSnapshot(s => {
    view.innerHTML = "";
    s.forEach(doc => {
      const a = doc.data();
      const card = document.createElement('div');
      card.className='album-card';
      const cover = a.coverUrl ? a.coverUrl : placeholderCover;
      card.innerHTML = `
        <img class="album-cover" src="${cover}" />
        <div class="album-name">${a.name}</div>
        <div class="album-count" id="count-${doc.id}">...–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div>
      `;
      card.onclick = () => openAlbum(doc.id, a.name);
      view.appendChild(card);

      // –æ—Ç—Ä–∏–º—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ñ–æ—Ç–æ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ)
      db.collection('albums').doc(doc.id).collection('photos').get().then(ps => {
        const el = document.getElementById(`count-${doc.id}`);
        if(el) el.textContent = ps.size + ' —Ñ–æ—Ç–æ';
      }).catch(()=>{});
    });

    if(s.empty) {
      view.innerHTML = '<div style="text-align:center; color:#ffbed9;">–ü—É—Å—Ç–æ ‚Äî —Å—Ç–≤–æ—Ä–∏ –ø–µ—Ä—à–∏–π –∞–ª—å–±–æ–º üíó</div>';
    }
  });
}

loadAlbums();

/* --- –í—ñ–¥–∫—Ä–∏—Ç–∏ –∞–ª—å–±–æ–º --- */
function openAlbum(id, name) {
  currentAlbum = id;
  document.getElementById('albums-section').style.display='none';
  document.getElementById('photos-section').style.display='block';
  document.getElementById('current-album-name').textContent = name;
  loadPhotos();
}

/* --- –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–æ—Ç–æ --- */
function loadPhotos() {
  const grid = document.getElementById('photos-view');
  grid.innerHTML = '';
  db.collection('albums').doc(currentAlbum).collection('photos').orderBy('timestamp').onSnapshot(s => {
    grid.innerHTML = '';
    s.forEach(doc => {
      const p = doc.data();
      const card = document.createElement('div');
      card.className='photo-card';
      card.innerHTML = `
        <img src="${p.url}" alt="" />
        <button class="delete-btn" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóë</button>
      `;
      card.querySelector('img').onclick = () => openImage(p.url, p.desc);
      card.querySelector('.delete-btn').onclick = (e) => { e.stopPropagation(); deletePhoto(doc.id); };
      grid.appendChild(card);
    });
    if(s.empty) grid.innerHTML = '<div style="color:#ffbed9; text-align:center; width:100%;">–£ —Ü—å–æ–º—É –∞–ª—å–±–æ–º—ñ —â–µ –Ω–µ–º–∞—î —Ñ–æ—Ç–æ</div>';
  });
}

/* --- –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–æ—Ç–æ --- */
function deletePhoto(id) {
  if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–æ—Ç–æ?')) {
    db.collection('albums').doc(currentAlbum).collection('photos').doc(id).delete().then(()=>{
      showToast('–§–æ—Ç–æ –≤–∏–¥–∞–ª–µ–Ω–æ');
    }).catch(err=>{ console.error(err); showToast('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ'); });
  }
}

/* --- –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –∞–ª—å–±–æ–º—ñ–≤ --- */
document.getElementById('back-to-albums').addEventListener('click', ()=>{
  currentAlbum = null;
  document.getElementById('photos-section').style.display='none';
  document.getElementById('albums-section').style.display='block';
});

/* --- –ú–æ–¥–∞–ª—ñ --- */
const addAlbumBtn = document.getElementById('add-album-btn');
const addAlbumModal = document.getElementById('add-album-modal');
addAlbumBtn.addEventListener('click', ()=>{ addAlbumModal.style.display='flex'; });
function closeAlbumModal(){ document.getElementById('album-name').value=''; document.getElementById('album-cover').value=''; addAlbumModal.style.display='none'; }

const addPhotoBtn = document.getElementById('add-photo-btn');
const addPhotoModal = document.getElementById('add-photo-modal');
addPhotoBtn.addEventListener('click', ()=>{ if(!currentAlbum){ alert('–û–±–µ—Ä—ñ—Ç—å –∞–ª—å–±–æ–º'); return; } addPhotoModal.style.display='flex'; });
function closePhotoModal(){ document.getElementById('photo-file').value=''; document.getElementById('photo-desc').value=''; addPhotoModal.style.display='none'; }

/* --- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∞–ª—å–±–æ–º—É --- */
document.getElementById('save-album').addEventListener('click', ()=>{
  const name = document.getElementById('album-name').value.trim();
  const file = document.getElementById('album-cover').files[0];
  if(!name){ alert('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∞–ª—å–±–æ–º—É'); return; }

  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      const coverData = e.target.result;
      db.collection('albums').add({ name:name, coverUrl:coverData, createdAt: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>{
        closeAlbumModal(); showToast('–ê–ª—å–±–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–æ');
      }).catch(err=>{ console.error(err); alert('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–ª—å–±–æ–º—É'); });
    }
    reader.readAsDataURL(file);
  } else {
    // –±–µ–∑ —Ñ–∞–π–ª—É ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ placeholder
    db.collection('albums').add({ name:name, coverUrl:placeholderCover, createdAt: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>{
      closeAlbumModal(); showToast('–ê–ª—å–±–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–æ');
    }).catch(err=>{ console.error(err); alert('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–ª—å–±–æ–º—É'); });
  }
});

/* --- –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–æ—Ç–æ --- */
document.getElementById('save-photo').addEventListener('click', ()=>{
  const file = document.getElementById('photo-file').files[0];
  const desc = document.getElementById('photo-desc').value.trim();
  if(!file){ alert('–í–∏–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª'); return; }
  const reader = new FileReader();
  reader.onload = function(e){
    const url = e.target.result;
    db.collection('albums').doc(currentAlbum).collection('photos').add({ url:url, desc:desc, timestamp: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>{
      closePhotoModal(); showToast('–§–æ—Ç–æ –¥–æ–¥–∞–Ω–æ');
    }).catch(err=>{ console.error(err); alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ —Ñ–æ—Ç–æ'); });
  }
  reader.readAsDataURL(file);
});

/* --- –ú–æ–¥–∞–ª—å–Ω–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —Ñ–æ—Ç–æ --- */
function openImage(url, desc){
  document.getElementById('modal-img').src = url;
  const im = document.getElementById('image-modal');
  im.style.display = 'flex';
}
function closeImageModal(){ document.getElementById('modal-img').src=''; document.getElementById('image-modal').style.display='none'; }

/* --- –ö–ª—ñ–∫ –ø–æ–∑–∞ –º–æ–¥–∞–ª–ª—é –∑–∞–∫—Ä–∏–≤–∞—î --- */
window.addEventListener('click', (e)=>{
  const modals = ['add-album-modal','add-photo-modal','image-modal'];
  modals.forEach(id=>{
    const el = document.getElementById(id);
    if(el && e.target === el) el.style.display='none';
  });
});

/* --- –ü—Ä–æ—Å—Ç–∏–π toast --- */
function showToast(txt){
  const t = document.getElementById('toast');
  t.textContent = txt; t.style.display='block';
  setTimeout(()=>{ t.style.display='none'; }, 2200);
}

</script>
</body>
</html>
